# Downstream Project Structure

Complete directory layout for a project built on bosun.

## Directory Tree

```
{{PROJECT_NAME}}/
├── .git/
├── .gitmodules                      # Git submodule config
├── .bosun-root                      # Marker file (sandbox.sh uses this)
│
├── upstream/                        # Git submodule — DO NOT edit files here
│   ├── packages/                    # Bosun's Pi packages
│   │   ├── pi-agents/               #   Agent discovery, model tiers, spawn_agent
│   │   ├── pi-daemon/               #   Background task daemon
│   │   ├── pi-tmux/                 #   Terminal tools (split_pane, send_keys, etc.)
│   │   ├── pi-question/             #   Enhanced question tool with TUI
│   │   ├── pi-session-context/      #   Session context and handoff tools
│   │   ├── pi-sandbox/              #   Tool-level sandboxing
│   │   ├── pi-meta-skills/          #   Meta skills for creating skills/extensions
│   │   └── pi-q/                    #   Task, project, roadmap management
│   ├── scripts/
│   │   ├── sandbox.sh               #   Process-level bwrap sandbox
│   │   ├── init.ts                  #   Upstream's config generator (reference only)
│   │   ├── tmux-helpers.sh          #   Shared tmux session helpers
│   │   ├── tmux-next-bosun.sh       #   Next session number calculator
│   │   └── daemon/handlers/         #   Stock daemon handlers
│   ├── .pi/
│   │   ├── agents/                  #   Stock agents (bosun, lite, verify, etc.)
│   │   └── skills/                  #   Generic skills (git, mesh, context-mgmt, etc.)
│   ├── config/
│   │   └── tmux.conf                #   Tmux configuration
│   └── config.sample.toml           #   Upstream's config template
│
├── .pi/
│   ├── agents/                      # YOUR agents (scanned first — wins on collision)
│   │   ├── {{ORCHESTRATOR}}.md      #   Main orchestrator (replaces bosun)
│   │   ├── trader.md                #   Example: domain specialist
│   │   └── hodor.md                 #   Example: CI review agent
│   ├── skills/                      # YOUR skills
│   │   ├── my-api/SKILL.md        #   Example: domain skill
│   │   ├── git/SKILL.md             #   Copied from upstream (generic)
│   │   └── context-management/      #   Copied from upstream (generic)
│   ├── extensions/                  # YOUR inline extensions (optional)
│   │   └── custom-tools/index.ts    #   Quick project-specific Pi tools
│   ├── settings.json                #   Generated by init.ts (gitignored)
│   ├── agents.json                  #   Generated by init.ts (gitignored)
│   ├── daemon.json                  #   Generated by init.ts (gitignored)
│   ├── sandbox.json                 #   Generated by init.ts (gitignored)
│   ├── bwrap.json                   #   Generated by init.ts (gitignored)
│   └── pi-mesh.json                 #   Generated by init.ts (gitignored)
│
├── packages/                        # YOUR Pi packages (optional)
│   └── pi-mylib/                     #   Example: domain tools extension
│       ├── package.json             #     Must have "pi" key for discovery
│       └── extensions/index.ts
│
├── config.sample.toml               # YOUR config template (checked in)
├── config.toml                      # YOUR config with API keys (gitignored)
│
├── scripts/
│   ├── init.ts                      # YOUR config generator (toml → .pi/*.json)
│   └── daemon/handlers/             # YOUR daemon handlers (optional)
│
├── config/
│   └── tmux.conf                    # Copied or symlinked from upstream
│
├── justfile                         # YOUR lifecycle commands
├── package.json                     # Workspaces: ["packages/*", "upstream/packages/*"]
├── flake.nix                        # Optional nix dev shell
├── .envrc                           # direnv config
├── .gitignore
├── README.md
│
├── .bosun-home/                     # Sandboxed HOME (gitignored)
│   ├── .pi/agent/                   #   Pi's auth, sessions, keybindings
│   ├── .ssh -> ~/.ssh               #   Symlink to host SSH
│   ├── .gitconfig                   #   Merged git config
│   └── tmux.sock                    #   Tmux socket
│
├── .bosun-daemon/                   # Daemon state (gitignored)
│   ├── daemon.log
│   ├── queue.json
│   └── status.json
│
└── workspace/                       # User data (gitignored)
    ├── users/
    │   └── {{USER}}/
    │       ├── plans/               #   Task plans
    │       ├── handoffs/            #   Session checkpoints
    │       ├── sessions/            #   Auto-summarized sessions
    │       └── public/chronicles/   #   Builder's logs
    └── backups/                     #   Daily workspace backups
```

## Discovery Order

### Agents
1. `.pi/agents/` (your project — wins on name collision)
2. Paths from `.pi/agents.json` `agentPaths` (upstream/.pi/agents/, etc.)

### Skills
1. `.pi/skills/` (your project)
2. Package skill directories (from packages listed in `.pi/settings.json`)

### Extensions
1. `.pi/extensions/` (your project — inline TS extensions)
2. Package extensions (from packages listed in `.pi/settings.json`)

### Packages
Both your `packages/*` and `upstream/packages/*` are in the bun workspace.
They're discovered via `.pi/settings.json` package paths.

## What's Gitignored

```
.bosun-home/          # Sandboxed HOME (auth, sessions, tmux socket)
.bosun-daemon/        # Daemon state
workspace/            # User data
config.toml           # API keys
.pi/settings.json     # Generated
.pi/agents.json       # Generated
.pi/daemon.json       # Generated
.pi/sandbox.json      # Generated
.pi/bwrap.json        # Generated
.pi/pi-mesh.json      # Generated
.pi/pi-q.json         # Generated
.pi/mesh/             # Mesh runtime state
.pi/npm/              # npm package cache
node_modules/
```

## What's Checked In

```
upstream/              # Submodule pointer (one line in .gitmodules)
.pi/agents/*.md        # Your agent definitions
.pi/skills/*/          # Your skills (domain + copied generic)
.pi/extensions/*/      # Your inline extensions
packages/*/            # Your Pi packages
config.sample.toml     # Config template (no secrets)
scripts/init.ts        # Config generator
justfile               # Lifecycle commands
package.json           # Dependencies
.bosun-root            # Marker file (empty)
```
